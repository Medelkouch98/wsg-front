<mat-card>
  <mat-card-content>
    <div class="mb-4 border-b border-slate-300 pb-2.5">
      <h5 class="font-medium uppercase">
        {{ 'qualite.exploitant-centre.title' | translate }}
      </h5>
    </div>
    <form
      [formGroup]="exploitantForm"
      class="flex flex-col"
      appMarkRequiredFormControlAsDirty
      [updateRequiredStatus$]="updateRequiredStatus$"
    >
      <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-x-5 2xl:grid-cols-3">
        <mat-form-field appFieldControlLabel>
          <mat-label>
            {{ 'commun.name' | translate }}
          </mat-label>
          <input matInput formControlName="nom" />
          <mat-error>
            {{ exploitantForm.controls.nom.errors | error }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appFieldControlLabel>
          <mat-label>
            {{ 'commun.prenom' | translate }}
          </mat-label>
          <input matInput formControlName="prenom" />
          <mat-error>
            {{ exploitantForm.controls.prenom.errors | error }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appFieldControlLabel="jj/mm/aaaa">
          <mat-label>
            {{ 'qualite.exploitant-centre.dateNaissance' | translate }}
          </mat-label>
          <input
            [matDatepicker]="picker"
            appCustomDateMaskDirective
            matInput
            formControlName="date_naissance"
          />
          <mat-datepicker-toggle
            [for]="picker"
            matSuffix
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error>
            {{ exploitantForm.controls.date_naissance.errors | error }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appFieldControlLabel>
          <mat-label>
            {{ 'qualite.exploitant-centre.villeNaissance' | translate }}
          </mat-label>
          <input matInput formControlName="ville_naissance" />
          <mat-error>
            {{ exploitantForm.controls.ville_naissance.errors | error }}
          </mat-error>
        </mat-form-field>
        <mat-form-field appFieldControlLabel="jj/mm/aaaa">
          <mat-label>
            {{ 'qualite.exploitant-centre.dateDesignation' | translate }}
          </mat-label>
          <input
            [matDatepicker]="picker1"
            appCustomDateMaskDirective
            matInput
            formControlName="date_designation"
            [max]="maxToDate"
          />
          <mat-datepicker-toggle
            [for]="picker1"
            matSuffix
          ></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
          <mat-error>
            {{ exploitantForm.controls.date_designation.errors | error }}
          </mat-error>
        </mat-form-field>
        <div class="flex flex-col pb-3">
          <div class="flex flex-row items-center">
            <mat-label class="text-primary">
              {{
                'qualite.exploitant-centre.attestationExploitant' | translate
              }}
            </mat-label>
            <button
              mat-icon-button
              (click)="openHelpPopup()"
              [matTooltip]="'commun.help' | translate"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            <input
              class="hidden"
              type="file"
              (change)="uploadFiles($event.target.files)"
              #file
            />
            <button
              mat-icon-button
              color="primary"
              (click)="file.click()"
              [disabled]="isReadOnly"
              [matTooltip]="
                'qualite.exploitant-centre.uploadAttestation' | translate
              "
            >
              <mat-icon>attach_file</mat-icon>
            </button>
            <button
              mat-icon-button
              color="primary"
              (click)="openManualAttestationPopup()"
              [disabled]="isReadOnly"
              [matTooltip]="
                'qualite.exploitant-centre.generateAttestation' | translate
              "
            >
              <mat-icon>add_circle_outline</mat-icon>
            </button>
          </div>
          <mat-chip
            class="cursor-pointer text-white"
            *ngIf="!!exploitantForm.contains('file')"
          >
            {{ exploitantForm.controls.file.value?.name }}
            <button matChipRemove (click)="deleteAttachedFile()">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <mat-chip
            class="cursor-pointer text-white"
            *ngIf="exploitantForm.controls?.date_signature?.value"
          >
            {{ generatedAttestationName }}
            <button matChipRemove (click)="resetGeneratedAttestation()">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        </div>
      </div>
    </form>
    <div class="flex items-center justify-end gap-x-2.5">
      <button
        mat-raised-button
        color="accent"
        (click)="addExploitant()"
        [disabled]="exploitantForm.invalid"
      >
        {{ 'commun.ajouter' | translate }}
      </button>
    </div>
  </mat-card-content>
</mat-card>
